<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>西葡語學習＋測驗</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(to bottom, #fdfbfb, #ebedee);
    margin: 0;
    padding: 0;
  }
  header {
    text-align: center;
    padding: 1rem;
    background: #ff7043;
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
  }
  main {
    max-width: 800px;
    margin: auto;
    padding: 1rem;
  }
  .card {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    margin-bottom: 1rem;
  }
  .word-es {
    font-size: 3rem;
    font-weight: bold;
    color: #ff7043;
  }
  .word-zh {
    font-size: 1.5rem;
    color: #555;
    margin-top: 0.5rem;
  }
  .controls, .quiz-options {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  button {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    background: #ffcc80;
    font-weight: bold;
  }
  button:hover {
    background: #ffb74d;
  }
  .quiz-options button {
    background: #90caf9;
  }
  .quiz-options button:hover {
    background: #64b5f6;
  }
  .upload-box {
    background: white;
    padding: 1rem;
    border-radius: 0.5rem;
    margin-top: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>
<header>📚 西班牙文＋葡萄牙文隨機學習 + 測驗</header>
<main>
  <div class="card">
    <div id="lang-label">[ES]</div>
    <div class="word-es" id="word-es">Hola</div>
    <div class="word-zh" id="word-zh">你好</div>
    <div class="controls">
      <button onclick="prevWord()">⬅ 上一個</button>
      <button onclick="speakCurrent()">🔊 發音</button>
      <button onclick="nextWord()">下一個 ➡</button>
    </div>
  </div>

  <div class="card" id="quiz-card" style="display:none;">
    <div><strong>測驗：</strong>這個單字的中文意思是？</div>
    <div class="word-es" id="quiz-word">Hola</div>
    <div class="quiz-options" id="quiz-options"></div>
  </div>

  <div class="upload-box">
    <label>📂 上傳語料（CSV 或 JSON）：</label>
    <input type="file" id="fileInput" />
  </div>
</main>

<script>
  const wordList = [
    { lang: "ES", word: "hola", zh: "你好" },
    { lang: "PT", word: "olá", zh: "你好" },
    { lang: "ES", word: "gracias", zh: "謝謝" },
    { lang: "PT", word: "obrigado", zh: "謝謝" },
    { lang: "ES", word: "adiós", zh: "再見" },
    { lang: "PT", word: "adeus", zh: "再見" }
  ];

  let currentIndex = 0;
  let autoTimer = null;

  function showWord(index) {
    const item = wordList[index];
    if (!item) return;
    document.getElementById("lang-label").textContent = item.lang === "ES" ? "[ES]" : "[PT]";
    document.getElementById("word-es").textContent = item.word;
    document.getElementById("word-zh").textContent = item.zh;
  }

  function nextWord() {
    currentIndex = (currentIndex + 1) % wordList.length;
    showWord(currentIndex);
  }

  function prevWord() {
    currentIndex = (currentIndex - 1 + wordList.length) % wordList.length;
    showWord(currentIndex);
  }

  function speakCurrent() {
    const item = wordList[currentIndex];
    if (!item) return;
    const utter = new SpeechSynthesisUtterance(item.word);
    utter.lang = item.lang === "ES" ? "es-ES" : "pt-PT";
    speechSynthesis.speak(utter);
  }

  function startQuiz() {
    document.getElementById("quiz-card").style.display = "block";
    const qIndex = Math.floor(Math.random() * wordList.length);
    const correct = wordList[qIndex];
    document.getElementById("quiz-word").textContent = correct.word;

    const options = [correct.zh];
    while (options.length < 4) {
      const rnd = wordList[Math.floor(Math.random() * wordList.length)].zh;
      if (!options.includes(rnd)) options.push(rnd);
    }
    options.sort(() => Math.random() - 0.5);

    const container = document.getElementById("quiz-options");
    container.innerHTML = "";
    options.forEach(opt => {
      const btn = document.createElement("button");
      btn.textContent = opt;
      btn.onclick = () => {
        if (opt === correct.zh) {
          alert("✅ 答對了！");
        } else {
          alert(`❌ 錯誤，正確答案是：${correct.zh}`);
        }
        startQuiz();
      };
      container.appendChild(btn);
    });
  }

  document.getElementById("fileInput").addEventListener("change", function(evt) {
    const file = evt.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        let text = e.target.result.trim();
        let list;
        if (text.startsWith("[")) {
          list = JSON.parse(text);
        } else {
          list = text.split(/\n+/).map(line => {
            const [lang, word, zh] = line.split(",");
            return { lang: lang.trim(), word: word.trim(), zh: zh.trim() };
          });
        }
        if (Array.isArray(list) && list.length) {
          wordList.splice(0, wordList.length, ...list);
          currentIndex = 0;
          showWord(0);
        }
      } catch(err) {
        alert("匯入失敗：" + err);
      }
    };
    reader.readAsText(file);
  });

  function startAuto(interval = 4) {
    clearInterval(autoTimer);
    autoTimer = setInterval(nextWord, interval * 1000);
  }

  window.onload = function() {
    if (wordList.length) {
      showWord(0);
    }
    startAuto(4);
    setTimeout(startQuiz, 8000);
  };
</script>
</body>
</html>
